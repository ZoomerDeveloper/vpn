# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ VPN —Å–µ—Ä–≤–µ—Ä–∞

## –ë—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–±

```bash
cd /opt/vpn-service/scripts
bash add-new-vpn-server.sh SERVER_IP SERVER_NAME
```

**–ü—Ä–∏–º–µ—Ä:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤—Ç–æ—Ä–æ–π —Å–µ—Ä–≤–µ—Ä (BR) —Å –ø–æ–¥—Å–µ—Ç—å—é 10.10.0.0/24
WG_NETWORK=10.10.0.0/24 bash add-new-vpn-server.sh 92.246.128.88 server2

# –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ—Ç–∏–π —Å–µ—Ä–≤–µ—Ä (TR) —Å –ø–æ–¥—Å–µ—Ç—å—é 10.20.0.0/24
WG_NETWORK=10.20.0.0/24 bash add-new-vpn-server.sh 192.168.1.101 server3
```

**–í–∞–∂–Ω–æ:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤!

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç WireGuard –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç MTU = 1280
3. ‚úÖ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–µ—Ä–≤–µ—Ä –≤ backend

## –†—É—á–Ω–æ–π —Å–ø–æ—Å–æ–± (–ø–æ —à–∞–≥–∞–º)

### –®–ê–ì 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å WireGuard –Ω–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
ssh root@NEW_SERVER_IP

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏
cd /opt/vpn-service
bash scripts/setup-wireguard.sh
```

### –®–ê–ì 2: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å MTU = 1280

```bash
# –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
bash scripts/fix-server-mtu.sh
```

–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:
```bash
sudo nano /etc/wireguard/wg0.conf

# –î–æ–±–∞–≤–∏—Ç—å –≤ [Interface]:
MTU = 1280

sudo systemctl restart wg-quick@wg0
```

### –®–ê–ì 3: –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ù–∞ –Ω–æ–≤–æ–º —Å–µ—Ä–≤–µ—Ä–µ
cat /etc/wireguard/server_public.key
cat /etc/wireguard/server_private.key
wg show wg0 listen-port | awk '{print $3}'
curl ifconfig.me  # –ø—É–±–ª–∏—á–Ω—ã–π IP
```

### –®–ê–ì 4: –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –≤ backend

**–ß–µ—Ä–µ–∑ API:**
```bash
curl -X POST http://localhost:3000/wireguard/servers \
  -H "Content-Type: application/json" \
  -d '{
    "name": "server2",
    "host": "NEW_SERVER_PUBLIC_IP",
    "port": 443,
    "publicIp": "NEW_SERVER_PUBLIC_IP",
    "privateIp": "10.0.0.1",
    "endpoint": "NEW_SERVER_PUBLIC_IP",
    "network": "10.0.0.0/24",
    "dns": "1.1.1.1",
    "publicKey": "SERVER_PUBLIC_KEY",
    "privateKey": "SERVER_PRIVATE_KEY"
  }'
```

**–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É:**
1. –ó–∞–π—Ç–∏ –≤ –∞–¥–º–∏–Ω–∫—É ‚Üí –°–µ—Ä–≤–µ—Ä—ã
2. –ù–∞–∂–∞—Ç—å "–î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É

## –í–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### Network (–ø–æ–¥—Å–µ—Ç—å)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Å–µ—Ç–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤:

- Server 1: `10.0.0.0/24` (IP –∫–ª–∏–µ–Ω—Ç–æ–≤: 10.0.0.2-254)
- Server 2: `10.0.1.0/24` (IP –∫–ª–∏–µ–Ω—Ç–æ–≤: 10.0.1.2-254)
- Server 3: `10.0.2.0/24` (IP –∫–ª–∏–µ–Ω—Ç–æ–≤: 10.0.2.2-254)

–≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ IP –∞–¥—Ä–µ—Å–æ–≤.

**–ò–ª–∏** –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω—É –ø–æ–¥—Å–µ—Ç—å, –Ω–æ —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å —á—Ç–æ–±—ã IP –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–ª–∏—Å—å (—Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–¥–µ–ª—è–µ—Ç IP –ø–æ —Å—á–µ—Ç—á–∏–∫—É peers).

### –ü–æ—Ä—Ç

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **443/UDP** –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ (–ª—É—á—à–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ DPI –≤ –†–§).

### DNS

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è **1.1.1.1** (Cloudflare) –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ –†–§.

### MTU

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:** MTU = 1280 –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –∏ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –∫–æ–Ω—Ñ–∏–≥–∞—Ö.

## –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤
curl http://localhost:3000/wireguard/servers

# –ò–ª–∏ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É ‚Üí –°–µ—Ä–≤–µ—Ä—ã
```

## –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

Backend –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–µ–∂–¥—É –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏:
- –í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö peers
- –ï—Å–ª–∏ –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã ‚Üí –æ—à–∏–±–∫–∞ (–Ω—É–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å maxPeers –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä)

## –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–î–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä:

**–ß–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ ‚Üí –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ù–∞–∂–∞—Ç—å "–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å" —Ä—è–¥–æ–º —Å peer
3. –í—ã–±—Ä–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä

**–ß–µ—Ä–µ–∑ API:**
```bash
curl -X POST http://localhost:3000/admin/vpn/peers/PEER_ID/migrate \
  -H "Content-Type: application/json" \
  -d '{"serverId": "NEW_SERVER_ID"}'
```

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è –†–§

- üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
- üáπüá∑ –¢—É—Ä—Ü–∏—è
- üá¶üá≤ –ê—Ä–º–µ–Ω–∏—è
- üá∑üá∏ –°–µ—Ä–±–∏—è
- üá´üáÆ –§–∏–Ω–ª—è–Ω–¥–∏—è

–ò–∑–±–µ–≥–∞–π—Ç–µ –ì–µ—Ä–º–∞–Ω–∏–∏ (Frankfurt) –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ—á–∫–∏ - —Ç–∞–º —á–∞—â–µ –±–ª–æ–∫–∏—Ä—É—é—Ç.

