# VPN Service MVP

Telegram-бот для продажи VPN-доступа на базе WireGuard.

## Архитектура

```
┌─────────────┐
│ Telegram Bot│
│  (Telegraf) │
└──────┬──────┘
       │ HTTP/WebSocket
       ▼
┌─────────────┐
│  Backend API│
│   (NestJS)  │
└──────┬──────┘
       │
       ├──────► PostgreSQL
       │
       └──────► WireGuard Servers
                  (wg CLI / API)
```

## Структура проекта

- `backend/` - NestJS API сервер
- `bot/` - Telegram бот (Telegraf)
- `shared/` - Общие типы и утилиты
- `scripts/` - Скрипты для деплоя и управления
- `docs/` - Документация

## Основные компоненты

### Backend (NestJS)
- User management
- VPN peer management (WireGuard)
- Payment processing (USDT TRC20)
- Tariff management
- Trial system

### Telegram Bot
- Команды: /start, trial, buy, status, support
- Отправка WireGuard конфигов
- QR-коды для мобильных устройств

### WireGuard
- Автоматическая генерация ключей
- Управление peers через wg CLI
- Поддержка нескольких серверов

## Быстрый старт

### Локальная разработка

1. **Backend:**
   ```bash
   cd backend
   npm install
   cp .env.example .env
   # Настройте .env файл
   npm run start:dev
   ```

2. **Telegram Bot:**
   ```bash
   cd bot
   npm install
   cp .env.example .env
   # Настройте .env файл (TELEGRAM_BOT_TOKEN, API_BASE_URL)
   npm run start:dev
   ```

3. **База данных:**
   ```bash
   # Создайте PostgreSQL базу данных
   createdb vpn_service
   
   # Запустите миграции (если есть)
   cd backend
   npm run migration:run
   
   # Заполните начальные данные
   ts-node src/database/seeds/seed.ts
   ```

4. **WireGuard сервер:**
   - Для локальной разработки можно использовать Docker или установить WireGuard локально
   - Или используйте удаленный сервер и настройте SSH доступ

### Деплой в продакшн

См. подробную инструкцию в `docs/DEPLOY.md`

## Документация

- `docs/DEPLOY.md` - Инструкция по деплою
- `docs/ARCHITECTURE.md` - Архитектура системы
- `docs/API.md` - API документация
- `docs/EXAMPLES.md` - Примеры использования

## Основные возможности

✅ **Trial система** - 24 часа бесплатного доступа  
✅ **Платные тарифы** - Месячная и годовая подписки  
✅ **Мульти-устройства** - Поддержка нескольких устройств на тариф  
✅ **Автоматизация** - Автоматическая генерация конфигов и QR-кодов  
✅ **Масштабирование** - Поддержка нескольких WireGuard серверов  
✅ **USDT TRC20** - Оплата криптовалютой  
✅ **Автоматическое истечение** - Проверка и деактивация истекших подписок  

## Технологии

- **Backend:** NestJS, TypeORM, PostgreSQL
- **Bot:** Telegraf (Node.js)
- **VPN:** WireGuard
- **Payments:** USDT TRC20 (TronGrid API)

## Структура проекта

```
vpn/
├── backend/              # NestJS Backend API
│   ├── src/
│   │   ├── users/       # Модуль пользователей
│   │   ├── vpn/         # VPN управление
│   │   ├── payments/    # Платежи
│   │   ├── tariffs/     # Тарифы
│   │   ├── wireguard/   # WireGuard серверы
│   │   └── tasks/       # Cron задачи
│   └── ...
├── bot/                 # Telegram Bot
│   ├── src/
│   │   ├── handlers/    # Обработчики команд
│   │   └── services/    # Сервисы бота
│   └── ...
├── scripts/             # Скрипты деплоя
├── docs/                # Документация
└── README.md
```

